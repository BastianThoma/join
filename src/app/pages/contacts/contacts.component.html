<!-- Hauptbereich für Kontakte mit semantischen Verbesserungen -->
<main class="contacts" role="main" [attr.aria-label]="'Kontakte verwalten'">
  
  <!-- Live Region für Screen Reader Updates -->
  <div 
    class="sr-only" 
    aria-live="polite" 
    aria-atomic="true"
    *ngIf="contactsStatusMessage">
    {{ contactsStatusMessage }}
  </div>

  <!-- Kontaktliste nach Buchstaben sortiert (Original Struktur) -->
  <section class="contacts__list" role="region" [attr.aria-label]="'Kontaktliste'">
    <ng-container *ngFor="let group of groupedContacts; trackBy: trackByGroup">
      <!-- Buchstaben-Überschrift -->
      <h2 class="contacts__letter" [id]="'letter-' + group.letter">
        {{ group.letter }}
      </h2>
      
      <!-- Kontakte für diesen Buchstaben (Original Funktionalität) -->
      <div
        *ngFor="let contact of group.contacts; trackBy: trackByContact"
        class="contacts__row"
        (click)="showContactDetail(contact)"
        [attr.aria-labelledby]="'contact-name-' + contact.id"
        [attr.aria-describedby]="'contact-email-' + contact.id"
        role="button"
        tabindex="0"
        (keydown.enter)="showContactDetail(contact)"
        (keydown.space)="$event.preventDefault(); showContactDetail(contact)">
        
        <!-- Avatar mit Initialen -->
        <div 
          class="contacts__avatar" 
          [ngStyle]="{ background: contact.color }"
          [attr.aria-hidden]="'true'">
          {{ getInitials(contact.name) }}
        </div>
        
        <!-- Kontaktinformationen -->
        <div class="contacts__info">
          <div 
            class="contacts__name" 
            [id]="'contact-name-' + contact.id">
            {{ contact.name }}
          </div>
          <div 
            class="contacts__email" 
            [id]="'contact-email-' + contact.id">
            {{ contact.email }}
          </div>
        </div>
      </div>
    </ng-container>
  </section>

  <!-- FAB Menu Wrapper (Original Struktur) -->
  <div class="fab-menu-wrapper" role="complementary" [attr.aria-label]="'Kontakt-Aktionen'">
    <!-- Hauptbutton (Original Funktionalität) -->
    <button
      class="contacts__fab"
      type="button"
      [attr.aria-label]="selectedContact ? 'Kontakt-Menü öffnen' : 'Neuen Kontakt hinzufügen'"
      (click)="selectedContact ? onFabMenuClick() : onFabAddClick()"
      [attr.aria-expanded]="showContactMenu"
      [attr.aria-controls]="showContactMenu ? 'contact-menu' : null">
      
      <img
        [src]="selectedContact ? '/assets/img/vertical_menu_dots.png' : '/assets/img/person_add_icon.png'"
        [alt]="selectedContact ? 'Menu' : 'Add Contact'" />
    </button>
    
    <!-- Kontakt-Menü (Original Struktur) -->
    <div
      *ngIf="showContactMenu"
      class="contact-menu-overlay"
      (click)="closeContactMenu()">
      
      <nav 
        class="contact-menu" 
        id="contact-menu"
        role="menu"
        (click)="$event.stopPropagation()">
        
        <button 
          class="contact-menu__item" 
          type="button"
          role="menuitem"
          (click)="editContact()">
          <img src="/assets/img/edit_icon_blue.png" alt="Edit" />
          <span>Edit</span>
        </button>
        
        <button
          class="contact-menu__item"
          type="button"
          role="menuitem"
          (click)="deleteContact()">
          <img src="/assets/img/delete_icon_blue.png" alt="Delete" />
          <span>Delete</span>
        </button>
      </nav>
    </div>
  </div>

  <!-- Detailansicht Overlay (Original Struktur mit semantischen Verbesserungen) -->
  <aside 
    class="contact-detail" 
    [class.contact-detail--open]="selectedContact"
    role="dialog"
    [attr.aria-modal]="selectedContact ? 'true' : 'false'"
    [attr.aria-labelledby]="'contact-detail-title'"
    [attr.aria-hidden]="!selectedContact">
    
    <!-- Header -->
    <header class="contact-detail__header">
      <h1 class="contact-detail__title" id="contact-detail-title">Contact Information</h1>
      <button 
        class="contact-detail__close" 
        type="button"
        [attr.aria-label]="'Zurück zur Kontaktliste'"
        (click)="closeContactDetail()">
        <img src="/assets/img/arrow_left.png" alt="Zurück" />
      </button>
    </header>
    
    <!-- Hauptinhalt -->
    <main class="contact-detail__main" *ngIf="selectedContact">
      <div class="contact-detail__header-info">
        <div
          class="contact-detail__avatar"
          [ngStyle]="{ background: selectedContact.color }"
          [attr.aria-hidden]="'true'">
          {{ getInitials(selectedContact.name) }}
        </div>
        
        <h2 class="contact-detail__name">{{ selectedContact.name }}</h2>
      </div>
      
      <dl class="contact-detail__info">
        <dt class="contact-detail__label">Email</dt>
        <dd class="contact-detail__email">{{ selectedContact.email }}</dd>
        
        <dt class="contact-detail__label">Phone</dt>
        <dd class="contact-detail__phone">
          {{ selectedContact.phone || "—" }}
        </dd>
      </dl>
    </main>
  </aside>
</main>

<!-- Add Contact Overlay (Original Struktur mit semantischen Verbesserungen) -->
<div 
  class="add-contact-overlay" 
  *ngIf="showAddContactOverlay"
  role="dialog"
  aria-modal="true"
  [attr.aria-labelledby]="'add-contact-title'">
  
  <div class="add-contact__card">
    <div class="add-contact__header">
      <span class="add-contact__title" id="add-contact-title">Add contact</span>
      <span class="add-contact__subtitle">Tasks are better with a team!</span>
      <button 
        class="add-contact__close" 
        type="button"
        [attr.aria-label]="'Dialog schließen'"
        (click)="closeAddContactOverlay()">
        <img src="/assets/img/close_small_white_icon.png" alt="Close" />
      </button>
    </div>
    
    <div class="add-contact__avatar">
      <img src="/assets/img/person_icon.png" alt="Avatar" />
    </div>
    
    <form class="add-contact__form" (submit)="addContact($event)">
      <div class="add-contact__input-group">
        <input
          type="text"
          placeholder="Name"
          class="input"
          [(ngModel)]="addName"
          name="addName"
          required />
        <span class="input-icon">
          <img src="assets/img/person_small_icon.png" alt="Name" />
        </span>
      </div>
      
      <div class="add-contact__input-group">
        <input
          type="email"
          placeholder="Email"
          class="input"
          [(ngModel)]="addEmail"
          name="addEmail"
          required />
        <span class="input-icon">
          <img src="assets/img/mail_small_icon.png" alt="Email" />
        </span>
      </div>
      
      <div class="add-contact__input-group">
        <input
          type="tel"
          placeholder="Phone"
          class="input"
          [(ngModel)]="addPhone"
          name="addPhone" />
        <span class="input-icon">
          <img src="/assets/img/phone_small_icon.png" alt="Phone" />
        </span>
      </div>
      
      <div *ngIf="addError" style="color: #e74c3c; font-size: 12px">
        {{ addError }}
      </div>
      
      <button type="submit" class="add-contact__submit">
        Create contact<img src="/assets/img/check_small_icon.png" alt="Check" />
      </button>
    </form>
  </div>
</div>

<!-- Edit Contact Overlay (Original Struktur mit semantischen Verbesserungen) -->
<div 
  class="add-contact-overlay" 
  *ngIf="showEditContactOverlay"
  role="dialog"
  aria-modal="true"
  [attr.aria-labelledby]="'edit-contact-title'">
  
  <div class="add-contact__card">
    <div class="add-contact__header">
      <span class="add-contact__title" id="edit-contact-title">Edit contact</span>
      <span class="add-contact__subtitle">Change contact details</span>
      <button 
        class="add-contact__close" 
        type="button"
        [attr.aria-label]="'Dialog schließen'"
        (click)="closeEditContactOverlay()">
        <img src="/assets/img/close_small_white_icon.png" alt="Close" />
      </button>
    </div>
    
    <div
      class="add-contact__avatar edit__avatar"
      [ngStyle]="{ background: selectedContact?.color || '#f1f1f1' }">
      {{ getInitials(editName) }}
    </div>
    
    <form class="add-contact__form" (submit)="saveEditContact($event)">
      <div class="add-contact__input-group">
        <input
          type="text"
          placeholder="Name"
          class="input"
          [(ngModel)]="editName"
          name="editName"
          required />
        <span class="input-icon">
          <img src="assets/img/person_small_icon.png" alt="Name" />
        </span>
      </div>
      
      <div class="add-contact__input-group">
        <input
          type="email"
          placeholder="Email"
          class="input"
          [(ngModel)]="editEmail"
          name="editEmail"
          required />
        <span class="input-icon">
          <img src="assets/img/mail_small_icon.png" alt="Email" />
        </span>
      </div>
      
      <div class="add-contact__input-group">
        <input
          type="tel"
          placeholder="Phone"
          class="input"
          [(ngModel)]="editPhone"
          name="editPhone" />
        <span class="input-icon">
          <img src="/assets/img/phone_small_icon.png" alt="Phone" />
        </span>
      </div>
      
      <div *ngIf="editError" style="color: #e74c3c; font-size: 12px">
        {{ editError }}
      </div>
      
      <button type="submit" class="add-contact__submit">
        Save changes <img src="/assets/img/check_small_icon.png" alt="Check" />
      </button>
    </form>
  </div>
</div>
